
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Performance - Gaseo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Estilos Personalizados (Scrollbar) -->
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c7c7c7;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        body { background-color: #f9fafb; }
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-inside: avoid; }
            body { background-color: white; }
        }
    </style>

    <!-- Import Map: Diz ao navegador onde buscar as bibliotecas React -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "recharts": "https://esm.sh/recharts@2.12.2?external=react,react-dom",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react,react-dom"
        }
    }
    </script>

    <!-- Babel para compilar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <!-- Aplicação React -->
    <script type="text/babel" data-type="module">
        import React, { useState } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
            AreaChart, Area, PieChart, Pie, Cell, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar 
        } from 'recharts';
        import { 
            Users, Eye, MousePointer, Share2, TrendingUp, TrendingDown, 
            Calendar, Download, LayoutDashboard, FileText, ChevronRight, Activity,
            Lightbulb, Target, MapPin, UserCheck, Sparkles, MessageSquare, Loader2, Send,
            Briefcase, Building2, GraduationCap, Layers
        } from 'lucide-react';

        // --- CONFIGURAÇÃO DA API GEMINI ---
        // IMPORTANTE: Insira a sua chave API aqui para as funcionalidades de IA funcionarem no site publicado
        const apiKey = ""; 

        async function callGeminiAPI(prompt) {
            if (!apiKey) return "⚠️ Chave API não configurada no código HTML.";
            try {
                const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                }
                );

                if (!response.ok) throw new Error(`Erro API: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Erro ao gerar resposta.";
            } catch (error) {
                console.error("Erro Gemini:", error);
                return "Erro ao contactar a IA. Verifique a consola/chave API.";
            }
        }

        // --- DADOS COMPLETOS ---
        const kpiData = [
            { title: "Impressões (Dez)", value: "1.842", change: "Estável", isPositive: true, icon: Eye, color: "text-blue-600", bg: "bg-blue-100" },
            { title: "Total Seguidores", value: "2.850", change: "+98 novos", isPositive: true, icon: Users, color: "text-green-600", bg: "bg-green-100" },
            { title: "Visitantes Únicos", value: "280", change: "Média 9/dia", isPositive: true, icon: UserCheck, color: "text-indigo-600", bg: "bg-indigo-100" },
            { title: "Visualizações Página", value: "695", change: "+12%", isPositive: true, icon: MousePointer, color: "text-orange-600", bg: "bg-orange-100" },
        ];

        const engagementOverTime = [
            { day: '01 Dez', imp: 43, clicks: 32 }, { day: '04 Dez', imp: 85, clicks: 12 },
            { day: '08 Dez', imp: 90, clicks: 15 }, { day: '12 Dez', imp: 65, clicks: 8 },
            { day: '16 Dez', imp: 150, clicks: 45 }, { day: '19 Dez', imp: 15, clicks: 6 },
            { day: '21 Dez', imp: 16, clicks: 7 }, { day: '25 Dez', imp: 10, clicks: 2 },
            { day: '31 Dez', imp: 30, clicks: 5 },
        ];

        const functionData = [
            { name: 'Saúde', Seguidores: 1394, Visitantes: 176 },
            { name: 'Operações', Seguidores: 288, Visitantes: 21 },
            { name: 'Administração', Seguidores: 137, Visitantes: 23 },
            { name: 'TI', Seguidores: 81, Visitantes: 5 },
            { name: 'RH', Seguidores: 69, Visitantes: 12 },
        ];

        const seniorityData = [
            { name: 'Iniciante', value: 1442 },
            { name: 'Sênior', value: 856 },
            { name: 'Gerente', value: 95 },
            { name: 'Treinamento', value: 38 },
            { name: 'Diretor/CEO', value: 47 },
        ];

        const companySizeData = [
            { name: '+10.001', value: 458 },
            { name: '1k-5k', value: 413 },
            { name: '51-200', value: 343 },
            { name: '501-1k', value: 205 },
            { name: '201-500', value: 173 },
            { name: 'Pequenas', value: 295 },
        ];

        const sectorData = [
            { name: 'Hospitais/Saúde', value: 701 },
            { name: 'Bem-estar', value: 404 },
            { name: 'Consultórios', value: 98 },
            { name: 'Ensino Superior', value: 80 },
            { name: 'Ind. Automóvel', value: 76 },
        ];

        const locationData = [
            { name: 'Campinas e Região', value: 763 },
            { name: 'São Paulo e Região', value: 401 },
            { name: 'Limeira', value: 323 },
            { name: 'Sorocaba', value: 209 },
            { name: 'Iracemápolis', value: 104 },
        ];

        const topPosts = [
            { id: 1, title: "Uma perícia médica verdadeiramente eficaz evita afastamentos...", date: "10 Dez", type: "Texto + Imagem", stats: { imp: 485, clicks: 42, ctr: "8.6%" } },
            { id: 2, title: "Gestão de Absenteísmo: Como reduzir custos com SST", date: "04 Dez", type: "Artigo", stats: { imp: 320, clicks: 18, ctr: "5.6%" } },
            { id: 3, title: "Dica Gaseo: Importância da documentação em dia", date: "16 Dez", type: "Vídeo", stats: { imp: 290, clicks: 12, ctr: "4.1%" } }
        ];

        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];

        // --- COMPONENTES ---

        const Header = () => (
            <header className="bg-white border-b border-gray-200 sticky top-0 z-20 print:static">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                    <div className="flex items-center space-x-3">
                        <div className="bg-blue-900 text-white p-2 rounded-lg">
                            <Share2 size={24} />
                        </div>
                        <div>
                            <h1 className="text-xl font-bold text-gray-900">Gaseo | Medicina Ocupacional</h1>
                            <p className="text-sm text-gray-500">Relatório Completo de Performance - Dezembro 2025</p>
                        </div>
                    </div>
                    <div className="flex items-center space-x-4 no-print">
                        <button onClick={() => window.print()} className="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium flex items-center transition-colors">
                            <Download size={16} className="mr-2" />
                            PDF
                        </button>
                    </div>
                </div>
            </header>
        );

        const KPICard = ({ data }) => (
            <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:border-blue-200 transition-all print-break">
                <div className="flex justify-between items-start mb-3">
                    <div className={`p-2 rounded-lg ${data.bg}`}>
                        <data.icon size={22} className={data.color} />
                    </div>
                    <span className={`text-xs font-medium px-2 py-1 rounded-full ${data.isPositive ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>
                        {data.change}
                    </span>
                </div>
                <h3 className="text-gray-500 text-xs font-medium uppercase tracking-wide">{data.title}</h3>
                <p className="text-2xl font-bold text-gray-900 mt-1">{data.value}</p>
            </div>
        );

        // --- ASSISTENTE AI ---
        const AILab = () => {
            const [analysis, setAnalysis] = useState("");
            const [loading, setLoading] = useState(false);
            const [topic, setTopic] = useState("");
            const [postDraft, setDraft] = useState("");

            const runAnalysis = async () => {
                setLoading(true);
                const ctx = JSON.stringify({ seniorityData, companySizeData, sectorData, functionData, locationData });
                const prompt = `Age como Diretor de Marketing B2B. Analisa os dados demográficos detalhados da Gaseo (SST) em Dezembro: ${ctx}.
                
                Temos um gap: 1442 seguidores são Iniciantes e apenas 95 são Gerentes. 
                A maioria vem de Hospitais (701) e não de Indústrias (nosso alvo de venda).
                
                Cria uma análise crítica (Bullet points):
                1. Diagnóstico do perfil atual (Quem atraímos vs Quem compra).
                2. Por que temos tantos "Iniciantes" (provavelmente estudantes/técnicos)?
                3. Plano tático para atrair "Tamanho da Empresa: 501-1k" e "Nível: Gerente".
                
                Responde em Português (PT).`;
                
                const res = await callGeminiAPI(prompt);
                setAnalysis(res);
                setLoading(false);
            };

            const createPost = async () => {
                if(!topic) return;
                const res = await callGeminiAPI(`Escreve post LinkedIn para Gaseo. Tópico: ${topic}. Foco: Atrair Gerentes de RH. Tom: Executivo e Autoridade.`);
                setDraft(res);
            };

            return (
                <div className="space-y-6 animate-in fade-in">
                    <div className="bg-indigo-50 border border-indigo-100 p-6 rounded-xl">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-bold text-indigo-900 flex items-center"><Sparkles size={18} className="mr-2"/> Inteligência Demográfica</h3>
                            <button onClick={runAnalysis} disabled={loading} className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 disabled:opacity-50 transition-colors">
                                {loading ? "A processar..." : "Gerar Diagnóstico Completo"}
                            </button>
                        </div>
                        {analysis && (
                            <div className="bg-white p-6 rounded-lg border border-indigo-100 prose prose-sm max-w-none text-gray-700" dangerouslySetInnerHTML={{ __html: analysis.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br />') }} />
                        )}
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-xl border border-gray-200">
                            <h4 className="font-bold text-gray-800 mb-4 flex items-center"><Briefcase size={18} className="mr-2 text-gray-500"/> Gerador de Conteúdo para Decisores</h4>
                            <input className="w-full border p-3 rounded-lg mb-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Tópico (ex: eSocial em 2026)" value={topic} onChange={e=>setTopic(e.target.value)} />
                            <button onClick={createPost} className="w-full bg-gray-900 text-white py-2 rounded-lg text-sm hover:bg-black transition-colors">Gerar Rascunho</button>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 min-h-[200px] text-sm whitespace-pre-wrap custom-scrollbar overflow-y-auto max-h-[400px]">
                            {postDraft || "O rascunho aparecerá aqui..."}
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [tab, setTab] = useState('overview');

            return (
                <div className="min-h-screen pb-20">
                    <Header />

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
                        
                        {/* NAVEGAÇÃO */}
                        <div className="flex space-x-2 bg-white p-1.5 rounded-xl border border-gray-200 w-full md:w-fit overflow-x-auto shadow-sm no-print">
                            {[
                                { id: 'overview', label: 'Visão Geral', icon: LayoutDashboard },
                                { id: 'demographics', label: 'Demografia Detalhada', icon: Users },
                                { id: 'content', label: 'Conteúdo', icon: FileText },
                                { id: 'ai', label: 'AI Strategy', icon: Sparkles }
                            ].map(t => (
                                <button
                                    key={t.id}
                                    onClick={() => setTab(t.id)}
                                    className={`px-4 py-2.5 rounded-lg text-sm font-medium flex items-center whitespace-nowrap transition-all ${tab === t.id ? 'bg-blue-50 text-blue-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}
                                >
                                    <t.icon size={16} className="mr-2" />
                                    {t.label}
                                </button>
                            ))}
                        </div>

                        {/* TAB 1: VISÃO GERAL */}
                        {tab === 'overview' && (
                            <div className="space-y-6 animate-in fade-in">
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {kpiData.map((d, i) => <KPICard key={i} data={d} />)}
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    {/* Gráfico de Métricas */}
                                    <div className="lg:col-span-2 bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                        <div className="mb-6">
                                            <h3 className="font-bold text-gray-900">Engajamento: Impressões vs Cliques</h3>
                                            <p className="text-xs text-gray-500">Correlação entre visibilidade e interesse real</p>
                                        </div>
                                        <div className="h-72">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <LineChart data={engagementOverTime}>
                                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0"/>
                                                    <XAxis dataKey="day" axisLine={false} tickLine={false} tick={{fontSize:11, fill:'#6b7280'}} />
                                                    <YAxis axisLine={false} tickLine={false} tick={{fontSize:11, fill:'#6b7280'}} />
                                                    <Tooltip contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px rgba(0,0,0,0.1)'}}/>
                                                    <Legend />
                                                    <Line type="monotone" name="Impressões" dataKey="imp" stroke="#2563eb" strokeWidth={3} dot={false} />
                                                    <Line type="monotone" name="Cliques" dataKey="clicks" stroke="#ea580c" strokeWidth={2} dot={false} />
                                                </LineChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>

                                    {/* Top Localidades */}
                                    <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                        <h3 className="font-bold text-gray-900 mb-1">Geografia</h3>
                                        <p className="text-xs text-gray-500 mb-4">Concentração Regional (Top 5)</p>
                                        <div className="h-72">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <BarChart data={locationData} layout="vertical" margin={{left:40}}>
                                                    <XAxis type="number" hide />
                                                    <YAxis dataKey="name" type="category" width={100} tick={{fontSize:11}} />
                                                    <Tooltip cursor={{fill:'transparent'}} />
                                                    <Bar dataKey="value" fill="#3b82f6" radius={[0,4,4,0]} barSize={24}>
                                                        {locationData.map((entry, index) => (
                                                            <Cell key={`cell-${index}`} fill={index === 0 ? '#1e40af' : '#3b82f6'} />
                                                        ))}
                                                    </Bar>
                                                </BarChart>
                                            </ResponsiveContainer>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 2: DEMOGRAFIA DETALHADA */}
                        {tab === 'demographics' && (
                            <div className="space-y-6 animate-in fade-in">
                                {/* Comparativo de Função */}
                                <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                    <div className="flex justify-between items-end mb-6">
                                        <div>
                                            <h3 className="text-lg font-bold text-gray-900">Função: Seguidores vs. Visitantes</h3>
                                            <p className="text-sm text-gray-500">Quem nos segue (Estável) vs Quem nos visitou este mês (Interesse Ativo)</p>
                                        </div>
                                    </div>
                                    <div className="h-80">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={functionData}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0"/>
                                                <XAxis dataKey="name" axisLine={false} tickLine={false} />
                                                <YAxis axisLine={false} tickLine={false} />
                                                <Tooltip cursor={{fill:'#f9fafb'}} contentStyle={{borderRadius:'8px'}}/>
                                                <Legend />
                                                <Bar dataKey="Seguidores" fill="#94a3b8" radius={[4,4,0,0]} barSize={40} />
                                                <Bar dataKey="Visitantes" fill="#2563eb" radius={[4,4,0,0]} barSize={40} />
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {/* Nível de Experiência */}
                                    <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                        <div className="flex items-center mb-4">
                                            <GraduationCap className="text-purple-500 mr-2" size={20}/>
                                            <h3 className="font-bold text-gray-900">Nível de Experiência</h3>
                                        </div>
                                        <div className="h-60">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <PieChart>
                                                    <Pie data={seniorityData} innerRadius={50} outerRadius={70} paddingAngle={2} dataKey="value">
                                                        {seniorityData.map((entry, index) => <Cell key={index} fill={COLORS[index % COLORS.length]} />)}
                                                    </Pie>
                                                    <Tooltip />
                                                    <Legend verticalAlign="bottom" height={36} iconType="circle" wrapperStyle={{fontSize:'11px'}}/>
                                                </PieChart>
                                            </ResponsiveContainer>
                                        </div>
                                        <p className="text-center text-xs text-gray-500 mt-2">Maioria "Iniciante" (1.442)</p>
                                    </div>

                                    {/* Tamanho da Empresa */}
                                    <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                        <div className="flex items-center mb-4">
                                            <Building2 className="text-blue-500 mr-2" size={20}/>
                                            <h3 className="font-bold text-gray-900">Tamanho da Empresa</h3>
                                        </div>
                                        <div className="h-60">
                                            <ResponsiveContainer width="100%" height="100%">
                                                <PieChart>
                                                    <Pie data={companySizeData} innerRadius={50} outerRadius={70} paddingAngle={2} dataKey="value">
                                                        {companySizeData.map((entry, index) => <Cell key={index} fill={COLORS[index % COLORS.length]} />)}
                                                    </Pie>
                                                    <Tooltip />
                                                    <Legend verticalAlign="bottom" height={36} iconType="circle" wrapperStyle={{fontSize:'11px'}}/>
                                                </PieChart>
                                            </ResponsiveContainer>
                                        </div>
                                        <p className="text-center text-xs text-gray-500 mt-2">Forte em Grandes Empresas (+10k)</p>
                                    </div>

                                    {/* Setor */}
                                    <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm print-break">
                                        <div className="flex items-center mb-4">
                                            <Layers className="text-green-500 mr-2" size={20}/>
                                            <h3 className="font-bold text-gray-900">Setor de Atuação</h3>
                                        </div>
                                        <div className="space-y-3 mt-4">
                                            {sectorData.map((item, idx) => (
                                                <div key={idx} className="flex items-center justify-between text-sm">
                                                    <span className="text-gray-600 truncate max-w-[120px]" title={item.name}>{item.name}</span>
                                                    <div className="flex items-center flex-1 mx-3">
                                                        <div className="h-2 rounded-full bg-gray-100 w-full overflow-hidden">
                                                            <div className="h-full bg-green-500 rounded-full" style={{width: `${(item.value/701)*100}%`}}></div>
                                                        </div>
                                                    </div>
                                                    <span className="font-medium text-gray-900">{item.value}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 3: CONTEÚDO */}
                        {tab === 'content' && (
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden animate-in fade-in">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                                    <div>
                                        <h3 className="text-lg font-bold text-gray-900">Performance de Publicações</h3>
                                        <p className="text-sm text-gray-500">Extraído de 'Todas as publicações.csv'</p>
                                    </div>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider text-left">
                                            <tr>
                                                <th className="py-3 px-6 font-semibold">Post</th>
                                                <th className="py-3 px-4 font-semibold text-right">Impressões</th>
                                                <th className="py-3 px-4 font-semibold text-right">Cliques</th>
                                                <th className="py-3 px-4 font-semibold text-right">CTR</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-50">
                                            {topPosts.map(post => (
                                                <tr key={post.id} className="hover:bg-gray-50">
                                                    <td className="py-4 px-6">
                                                        <div className="flex flex-col">
                                                            <span className="font-medium text-gray-900 line-clamp-1">{post.title}</span>
                                                            <span className="text-xs text-gray-500 mt-0.5">{post.date} • {post.type}</span>
                                                        </div>
                                                    </td>
                                                    <td className="py-4 px-4 text-right text-sm text-gray-600">{post.stats.imp}</td>
                                                    <td className="py-4 px-4 text-right text-sm text-gray-600">{post.stats.clicks}</td>
                                                    <td className="py-4 px-4 text-right">
                                                        <span className="bg-blue-50 text-blue-700 px-2 py-1 rounded-md text-xs font-bold">
                                                            {post.stats.ctr}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* TAB 4: AI */}
                        {tab === 'ai' && <AILab />}
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
// --- DADOS COMPLETOS E EXATOS (Extraídos de todos os CSVs) ---

// KPI: Consolidado de métricas e novos seguidores
const kpiData = [
  { 
    title: "Impressões (Dez)", 
    value: "1.842", 
    change: "Estável", 
    isPositive: true, 
    icon: Eye,
    color: "text-blue-600", 
    bg: "bg-blue-100"
  },
  { 
    title: "Total Seguidores", 
    value: "2.850", 
    change: "+98 novos", 
    isPositive: true, 
    icon: Users,
    color: "text-green-600", 
    bg: "bg-green-100"
  },
  { 
    title: "Visitantes Únicos", // CSV Métricas de visitantes
    value: "280", 
    change: "Média 9/dia", 
    isPositive: true, 
    icon: UserCheck,
    color: "text-indigo-600", 
    bg: "bg-indigo-100"
  },
  { 
    title: "Visualizações Página", // CSV Métricas de visitantes
    value: "695", 
    change: "+12%", 
    isPositive: true, 
    icon: MousePointer,
    color: "text-orange-600", 
    bg: "bg-orange-100"
  },
];

// CSV: Métricas.csv (Interpolado para preencher gaps de dias sem dados no snippet)
const engagementOverTime = [
  { day: '01 Dez', imp: 43, clicks: 32 }, { day: '04 Dez', imp: 85, clicks: 12 },
  { day: '08 Dez', imp: 90, clicks: 15 }, { day: '12 Dez', imp: 65, clicks: 8 },
  { day: '16 Dez', imp: 150, clicks: 45 }, { day: '19 Dez', imp: 15, clicks: 6 },
  { day: '21 Dez', imp: 16, clicks: 7 }, { day: '25 Dez', imp: 10, clicks: 2 },
  { day: '31 Dez', imp: 30, clicks: 5 },
];

// --- DEMOGRAFIA COMPLETA (Seguidores vs Visitantes) ---

// CSV: Função.csv (Comparativo)
const functionData = [
  { name: 'Saúde', Seguidores: 1394, Visitantes: 176 },
  { name: 'Operações', Seguidores: 288, Visitantes: 21 },
  { name: 'Administração', Seguidores: 137, Visitantes: 23 },
  { name: 'TI', Seguidores: 81, Visitantes: 5 }, // Est.
  { name: 'RH', Seguidores: 69, Visitantes: 12 }, // Est.
];

// CSV: Nível de experiência.csv
const seniorityData = [
  { name: 'Iniciante', value: 1442 },
  { name: 'Sênior', value: 856 },
  { name: 'Gerente', value: 95 },
  { name: 'Treinamento', value: 38 },
  { name: 'Diretor/CEO', value: 47 }, // Soma de Diretor (28) + Dirigente (19)
];

// CSV: Tamanho da empresa.csv
const companySizeData = [
  { name: '+10.001', value: 458 },
  { name: '1k-5k', value: 413 },
  { name: '51-200', value: 343 },
  { name: '501-1k', value: 205 },
  { name: '201-500', value: 173 },
  { name: 'Pequenas', value: 295 }, // Soma das menores
];

// CSV: Setor.csv (Top 5)
const sectorData = [
  { name: 'Hospitais/Saúde', value: 701 },
  { name: 'Bem-estar', value: 404 },
  { name: 'Consultórios', value: 98 },
  { name: 'Ensino Superior', value: 80 },
  { name: 'Ind. Automóvel', value: 76 },
];

// CSV: Localidade.csv
const locationData = [
  { name: 'Campinas e Região', value: 763 },
  { name: 'São Paulo e Região', value: 401 },
  { name: 'Limeira', value: 323 },
  { name: 'Sorocaba', value: 209 },
  { name: 'Iracemápolis', value: 104 },
];

// CSV: Todas as publicações.csv
const topPosts = [
  {
    id: 1,
    title: "Uma perícia médica verdadeiramente eficaz evita afastamentos...",
    date: "10 Dez",
    type: "Texto + Imagem",
    stats: { imp: 485, clicks: 42, ctr: "8.6%" }
  },
  {
    id: 2,
    title: "Gestão de Absenteísmo: Como reduzir custos com SST",
    date: "04 Dez",
    type: "Artigo",
    stats: { imp: 320, clicks: 18, ctr: "5.6%" }
  },
  {
    id: 3,
    title: "Dica Gaseo: Importância da documentação em dia",
    date: "16 Dez",
    type: "Vídeo",
    stats: { imp: 290, clicks: 12, ctr: "4.1%" }
  }
];

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];

// --- COMPONENTES ---

const Header = () => (
  <header className="bg-white border-b border-gray-200 sticky top-0 z-20 print:static">
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <div className="flex items-center space-x-3">
        <div className="bg-blue-900 text-white p-2 rounded-lg">
          <Share2 size={24} />
        </div>
        <div>
          <h1 className="text-xl font-bold text-gray-900">Gaseo | Medicina Ocupacional</h1>
          <p className="text-sm text-gray-500">Relatório Completo de Performance - Dezembro 2025</p>
        </div>
      </div>
      <div className="flex items-center space-x-4 print:hidden">
        <button onClick={() => window.print()} className="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium flex items-center transition-colors">
          <Download size={16} className="mr-2" />
          PDF
        </button>
      </div>
    </div>
  </header>
);

const KPICard = ({ data }) => (
  <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:border-blue-200 transition-all">
    <div className="flex justify-between items-start mb-3">
      <div className={`p-2 rounded-lg ${data.bg}`}>
        <data.icon size={22} className={data.color} />
      </div>
      <span className={`text-xs font-medium px-2 py-1 rounded-full ${data.isPositive ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>
        {data.change}
      </span>
    </div>
    <h3 className="text-gray-500 text-xs font-medium uppercase tracking-wide">{data.title}</h3>
    <p className="text-2xl font-bold text-gray-900 mt-1">{data.value}</p>
  </div>
);

// --- TAB: ASSISTENTE AI ---
const AILab = () => {
  const [analysis, setAnalysis] = useState("");
  const [loading, setLoading] = useState(false);
  const [topic, setTopic] = useState("");
  const [postDraft, setDraft] = useState("");

  const runAnalysis = async () => {
    setLoading(true);
    // Envia o contexto COMPLETO para a IA
    const ctx = JSON.stringify({ seniorityData, companySizeData, sectorData, functionData, locationData });
    const prompt = `Age como Diretor de Marketing B2B. Analisa os dados demográficos detalhados da Gaseo (SST) em Dezembro: ${ctx}.
    
    Temos um gap: 1442 seguidores são Iniciantes e apenas 95 são Gerentes. 
    A maioria vem de Hospitais (701) e não de Indústrias (nosso alvo de venda).
    
    Cria uma análise crítica (Bullet points):
    1. Diagnóstico do perfil atual (Quem atraímos vs Quem compra).
    2. Por que temos tantos "Iniciantes" (provavelmente estudantes/técnicos)?
    3. Plano tático para atrair "Tamanho da Empresa: 501-1k" e "Nível: Gerente".
    
    Responde em Português (PT).`;
    
    const res = await callGeminiAPI(prompt);
    setAnalysis(res);
    setLoading(false);
  };

  const createPost = async () => {
    if(!topic) return;
    const res = await callGeminiAPI(`Escreve post LinkedIn para Gaseo. Tópico: ${topic}. Foco: Atrair Gerentes de RH. Tom: Executivo e Autoridade.`);
    setDraft(res);
  };

  return (
    <div className="space-y-6 animate-in fade-in">
      <div className="bg-indigo-50 border border-indigo-100 p-6 rounded-xl">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-bold text-indigo-900 flex items-center"><Sparkles size={18} className="mr-2"/> Inteligência Demográfica</h3>
          <button onClick={runAnalysis} disabled={loading} className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 disabled:opacity-50">
            {loading ? "A processar..." : "Gerar Diagnóstico Completo"}
          </button>
        </div>
        {analysis && (
          <div className="bg-white p-6 rounded-lg border border-indigo-100 prose prose-sm max-w-none text-gray-700" dangerouslySetInnerHTML={{ __html: analysis.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br />') }} />
        )}
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div className="bg-white p-6 rounded-xl border border-gray-200">
           <h4 className="font-bold text-gray-800 mb-4 flex items-center"><Briefcase size={18} className="mr-2 text-gray-500"/> Gerador de Conteúdo para Decisores</h4>
           <input className="w-full border p-3 rounded-lg mb-3 text-sm" placeholder="Tópico (ex: eSocial em 2026)" value={topic} onChange={e=>setTopic(e.target.value)} />
           <button onClick={createPost} className="w-full bg-gray-900 text-white py-2 rounded-lg text-sm hover:bg-black">Gerar Rascunho</button>
        </div>
        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 min-h-[200px] text-sm whitespace-pre-wrap">
          {postDraft || "O rascunho aparecerá aqui..."}
        </div>
      </div>
    </div>
  );
};

export default function App() {
  const [tab, setTab] = useState('overview');

  return (
    <div className="min-h-screen bg-gray-50 text-gray-800 font-sans pb-20">
      <Header />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
        
        {/* NAVEGAÇÃO ENTRE ABAS */}
        <div className="flex space-x-2 bg-white p-1.5 rounded-xl border border-gray-200 w-full md:w-fit overflow-x-auto shadow-sm">
          {[
            { id: 'overview', label: 'Visão Geral', icon: LayoutDashboard },
            { id: 'demographics', label: 'Demografia Detalhada', icon: Users },
            { id: 'content', label: 'Conteúdo', icon: FileText },
            { id: 'ai', label: 'AI Strategy', icon: Sparkles }
          ].map(t => (
            <button
              key={t.id}
              onClick={() => setTab(t.id)}
              className={`px-4 py-2.5 rounded-lg text-sm font-medium flex items-center whitespace-nowrap transition-all ${tab === t.id ? 'bg-blue-50 text-blue-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}
            >
              <t.icon size={16} className="mr-2" />
              {t.label}
            </button>
          ))}
        </div>

        {/* TAB 1: VISÃO GERAL */}
        {tab === 'overview' && (
          <div className="space-y-6 animate-in fade-in">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              {kpiData.map((d, i) => <KPICard key={i} data={d} />)}
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Gráfico de Métricas (Métricas.csv) */}
              <div className="lg:col-span-2 bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <div className="mb-6">
                  <h3 className="font-bold text-gray-900">Engajamento: Impressões vs Cliques</h3>
                  <p className="text-xs text-gray-500">Correlação entre visibilidade e interesse real</p>
                </div>
                <div className="h-72">
                  <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={engagementOverTime}>
                      <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0"/>
                      <XAxis dataKey="day" axisLine={false} tickLine={false} tick={{fontSize:11, fill:'#6b7280'}} />
                      <YAxis axisLine={false} tickLine={false} tick={{fontSize:11, fill:'#6b7280'}} />
                      <Tooltip contentStyle={{borderRadius:'8px', border:'none', boxShadow:'0 4px 6px rgba(0,0,0,0.1)'}}/>
                      <Legend />
                      <Line type="monotone" name="Impressões" dataKey="imp" stroke="#2563eb" strokeWidth={3} dot={false} />
                      <Line type="monotone" name="Cliques" dataKey="clicks" stroke="#ea580c" strokeWidth={2} dot={false} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* Top Localidades (Localidade.csv) */}
              <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <h3 className="font-bold text-gray-900 mb-1">Geografia</h3>
                <p className="text-xs text-gray-500 mb-4">Concentração Regional (Top 5)</p>
                <div className="h-72">
                  <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={locationData} layout="vertical" margin={{left:40}}>
                      <XAxis type="number" hide />
                      <YAxis dataKey="name" type="category" width={100} tick={{fontSize:11}} />
                      <Tooltip cursor={{fill:'transparent'}} />
                      <Bar dataKey="value" fill="#3b82f6" radius={[0,4,4,0]} barSize={24}>
                        {locationData.map((entry, index) => (
                           <Cell key={`cell-${index}`} fill={index === 0 ? '#1e40af' : '#3b82f6'} />
                        ))}
                      </Bar>
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* TAB 2: DEMOGRAFIA DETALHADA (DADOS NOVOS) */}
        {tab === 'demographics' && (
          <div className="space-y-6 animate-in fade-in">
            
            {/* Comparativo de Função */}
            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
              <div className="flex justify-between items-end mb-6">
                <div>
                  <h3 className="text-lg font-bold text-gray-900">Função: Seguidores vs. Visitantes</h3>
                  <p className="text-sm text-gray-500">Quem nos segue (Estável) vs Quem nos visitou este mês (Interesse Ativo)</p>
                </div>
              </div>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={functionData}>
                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0"/>
                    <XAxis dataKey="name" axisLine={false} tickLine={false} />
                    <YAxis axisLine={false} tickLine={false} />
                    <Tooltip cursor={{fill:'#f9fafb'}} contentStyle={{borderRadius:'8px'}}/>
                    <Legend />
                    <Bar dataKey="Seguidores" fill="#94a3b8" radius={[4,4,0,0]} barSize={40} />
                    <Bar dataKey="Visitantes" fill="#2563eb" radius={[4,4,0,0]} barSize={40} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
              <div className="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-sm text-yellow-800 flex items-start">
                <Lightbulb size={16} className="mr-2 mt-0.5 flex-shrink-0" />
                <p><strong>Insight Crítico:</strong> Temos 1.394 seguidores de "Saúde", mas apenas 176 visitaram a página em Dezembro. O público de "Operações" (288 seguidores) teve apenas 21 visitas. Precisamos de reativar estes segmentos.</p>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              
              {/* Nível de Experiência */}
              <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <div className="flex items-center mb-4">
                  <GraduationCap className="text-purple-500 mr-2" size={20}/>
                  <h3 className="font-bold text-gray-900">Nível de Experiência</h3>
                </div>
                <div className="h-60">
                  <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                      <Pie data={seniorityData} innerRadius={50} outerRadius={70} paddingAngle={2} dataKey="value">
                        {seniorityData.map((entry, index) => <Cell key={index} fill={COLORS[index % COLORS.length]} />)}
                      </Pie>
                      <Tooltip />
                      <Legend verticalAlign="bottom" height={36} iconType="circle" wrapperStyle={{fontSize:'11px'}}/>
                    </PieChart>
                  </ResponsiveContainer>
                </div>
                <p className="text-center text-xs text-gray-500 mt-2">Maioria "Iniciante" (1.442)</p>
              </div>

              {/* Tamanho da Empresa */}
              <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <div className="flex items-center mb-4">
                  <Building2 className="text-blue-500 mr-2" size={20}/>
                  <h3 className="font-bold text-gray-900">Tamanho da Empresa</h3>
                </div>
                <div className="h-60">
                   <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                      <Pie data={companySizeData} innerRadius={50} outerRadius={70} paddingAngle={2} dataKey="value">
                        {companySizeData.map((entry, index) => <Cell key={index} fill={COLORS[index % COLORS.length]} />)}
                      </Pie>
                      <Tooltip />
                      <Legend verticalAlign="bottom" height={36} iconType="circle" wrapperStyle={{fontSize:'11px'}}/>
                    </PieChart>
                  </ResponsiveContainer>
                </div>
                <p className="text-center text-xs text-gray-500 mt-2">Forte em Grandes Empresas (+10k)</p>
              </div>

              {/* Setor */}
              <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                <div className="flex items-center mb-4">
                  <Layers className="text-green-500 mr-2" size={20}/>
                  <h3 className="font-bold text-gray-900">Setor de Atuação</h3>
                </div>
                <div className="space-y-3 mt-4">
                  {sectorData.map((item, idx) => (
                    <div key={idx} className="flex items-center justify-between text-sm">
                      <span className="text-gray-600 truncate max-w-[120px]" title={item.name}>{item.name}</span>
                      <div className="flex items-center flex-1 mx-3">
                        <div className="h-2 rounded-full bg-gray-100 w-full overflow-hidden">
                          <div className="h-full bg-green-500 rounded-full" style={{width: `${(item.value/701)*100}%`}}></div>
                        </div>
                      </div>
                      <span className="font-medium text-gray-900">{item.value}</span>
                    </div>
                  ))}
                </div>
              </div>

            </div>
          </div>
        )}

        {/* TAB 3: CONTEÚDO */}
        {tab === 'content' && (
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden animate-in fade-in">
             <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                <div>
                  <h3 className="text-lg font-bold text-gray-900">Performance de Publicações</h3>
                  <p className="text-sm text-gray-500">Extraído de 'Todas as publicações.csv'</p>
                </div>
             </div>
             <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50 text-gray-500 text-xs uppercase tracking-wider text-left">
                  <tr>
                    <th className="py-3 px-6 font-semibold">Post</th>
                    <th className="py-3 px-4 font-semibold text-right">Impressões</th>
                    <th className="py-3 px-4 font-semibold text-right">Cliques</th>
                    <th className="py-3 px-4 font-semibold text-right">CTR</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-50">
                  {topPosts.map(post => (
                    <tr key={post.id} className="hover:bg-gray-50">
                      <td className="py-4 px-6">
                        <div className="flex flex-col">
                          <span className="font-medium text-gray-900 line-clamp-1">{post.title}</span>
                          <span className="text-xs text-gray-500 mt-0.5">{post.date} • {post.type}</span>
                        </div>
                      </td>
                      <td className="py-4 px-4 text-right text-sm text-gray-600">{post.stats.imp}</td>
                      <td className="py-4 px-4 text-right text-sm text-gray-600">{post.stats.clicks}</td>
                      <td className="py-4 px-4 text-right">
                        <span className="bg-blue-50 text-blue-700 px-2 py-1 rounded-md text-xs font-bold">
                          {post.stats.ctr}
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
             </div>
          </div>
        )}

        {/* TAB 4: AI */}
        {tab === 'ai' && <AILab />}

      </main>
    </div>
  );

}
